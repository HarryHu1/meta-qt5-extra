From 2d1e5bb9364a4badef83680b2fef6a6ab2b9c84e Mon Sep 17 00:00:00 2001
From: rncbc <rncbc@rncbc.org>
Date: Fri, 28 Dec 2018 17:05:54 +0000
Subject: [PATCH 1/3] - Comply with next LV2 headers location post-1.14.0git.
 (EXPERIMENTAL)

---
 configure.ac | 20 +++++++++++++++-----
 1 file changed, 15 insertions(+), 5 deletions(-)

diff --git a/configure.ac b/configure.ac
index 59de619..f25cd69 100644
--- a/configure.ac
+++ b/configure.ac
@@ -492,11 +492,21 @@ fi
 
 # Check for LV2 headers.
 if test "x$ac_lv2" = "xyes"; then
-   AC_CHECK_HEADERS(lv2.h \
-      lv2/lv2plug.in/ns/ext/atom/atom.h \
-      lv2/lv2plug.in/ns/ext/atom/forge.h \
-      lv2/lv2plug.in/ns/ext/atom/util.h,
-      [ac_lv2="yes"], [ac_lv2="no"])
+   PKG_CHECK_MODULES([LV2], [lv2], [ac_lv2="yes"], [ac_lv2="no"])
+   if test "x$ac_lv2" = "xyes"; then
+      ac_lv2 cflags="$ac_lv2_cflags $LV2_CFLAGS"
+      CFLAGS="$CFLAGS $LV2_CFLAGS"
+      CPPFLAGS="$CPPFLAGS $LV2_CFLAGS"
+   else
+      AC_CHECK_HEADER(lv2/lv2.h, [ac_lv2="yes"], [ac_lv2="no"])
+   fi
+   if test "x$ac_lv2" = "xyes"; then
+      AC_CHECK_HEADERS(
+         lv2/lv2plug.in/ns/ext/atom/atom.h \
+         lv2/lv2plug.in/ns/ext/atom/forge.h \
+         lv2/lv2plug.in/ns/ext/atom/util.h,
+         [ac_lv2="yes"], [ac_lv2="no"])
+   fi
    if test "x$ac_lv2" = "xyes"; then
       AC_DEFINE(CONFIG_LV2, 1, [Define if LV2 plug-in build is enabled.])
       ac_all_targets="lv2 $ac_all_targets"
-- 
2.20.1

